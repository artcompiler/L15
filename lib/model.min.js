var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString),forEach=function(b,c,d){if(Array.prototype.forEach)return b.forEach(c);b=toObject(b);var f=splitString&&"[object String]"==_toString(b)?b.split(""):b,n=-1,a=f.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError;for(;++n<a;)n in f&&c.call(d,f[n],n,b)},filter=function(b,c,d){if(Array.prototype.filter)return b.filter(c);var f=toObject(b);b=splitString&&"[object String]"==_toString(b)?b.split(""):f;var n=
b.length>>>0,a=[],e;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var l=0;l<n;l++)l in b&&(e=b[l],c.call(d,e,l,f)&&a.push(e));return a},every=function(b,c,d){if(Array.prototype.every)return b.every(c,d);var f=toObject(b);b=splitString&&"[object String]"==_toString(b)?b.split(""):f;var n=b.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var a=0;a<n;a++)if(a in b&&!c.call(d,b[a],a,f))return!1;return!0},some=function(b,
c,d){if(Array.prototype.some)return b.some(c,d);var f=toObject(b);b=splitString&&"[object String]"==_toString(b)?b.split(""):f;var n=b.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var a=0;a<n;a++)if(a in b&&c.call(d,b[a],a,f))return!0;return!1},indexOf=function(b,c){var d=arguments[2];if(Array.prototype.indexOf)return b.indexOf(c,d);var f=splitString&&"[object String]"==_toString(b)?b.split(""):toObject(b),n=f.length>>>0;if(!n)return-1;var a=0;2<
arguments.length&&(a=toInteger(d));for(a=0<=a?a:Math.max(0,n+a);a<n;a++)if(a in f&&f[a]===c)return a;return-1},keys=function(b){if(Object.keys)return Object.keys(b);var c=!0,d="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),f=d.length,n;for(n in{toString:null})c=!1;if("object"!=typeof b&&"function"!=typeof b||null===b)throw new TypeError("Object.keys called on a non-object");n=[];for(var a in b)owns(b,a)&&n.push(a);if(c)for(c=0;c<f;c++)a=
d[c],owns(b,a)&&n.push(a);return n},toObject=function(b){if(null==b)throw new TypeError("can't convert "+b+" to object");return Object(b)},prototypeOfObject=Object.prototype,_toString=function(b){return prototypeOfObject.toString.apply(b)},owns=function(b,c){return prototypeOfObject.hasOwnProperty.call(b,c)},create=function(b){if(Object.create)return Object.create(b);var c=function(){};if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");c.prototype=b;return new c};var ASSERT=!0,assert=function(){return ASSERT?function(b,c){void 0===c&&(c="failed!");if(!b){var d=Error(c);d.location=Assert.location;throw d;}}:function(){}}(),message=function(b,c){var d=Assert.messages[b];c&&forEach(c,function(b,c){d=d.replace("%"+(c+1),b)});return b+": "+d},reserveCodeRange=function(b,c,d){assert(b<=c,"Invalid code range");var f=every(Assert.reservedCodes,function(d){return c<d.first||b>d.last});assert(f,"Conflicting request for error code range");Assert.reservedCodes.push({first:b,
last:c,name:d})},setLocation=function(b){Assert.location=b},clearLocation=function(){Assert.location=null},Assert={assert:assert,message:message,messages:{},reserveCodeRange:reserveCodeRange,reservedCodes:[],setLocation:setLocation,clearLocation:clearLocation};var TRACE=!1,global=this,trace=function(){return TRACE?function(b){if(global.console&&global.console.log)console.log(b);else if(global.print)print(b);else throw"No trace function defined!";}:function(){}}();var Ast=function(){function b(){}function c(b){void 0===b&&(b=this);return b.op&&b.args}var d=["unused"],f={};b.clearPool=function(){d=["unused"];f={}};b.prototype.create=function a(b,c){var d=a(this);"string"===typeof b?(d.op=b,d.args=c instanceof Array?c:[]):null!==b&&"object"===typeof b&&forEach(keys(b),function(a,c){d[a]=b[a]});return d};b.prototype.arg=function(b){if(!c(this))throw"Malformed node";this.args.push(b);return this};b.prototype.argN=function(b,e){if(!c(this))throw"Malformed node";
if(void 0===e)return this.args[b];this.args[b]=e;return this};b.prototype.args=function(b){if(!c(this))throw"Malformed node";if(void 0===b)return this.args;this.args=b;return this};b.prototype.isNode=c;b.intern=b.prototype.intern=function e(l){this instanceof b&&void 0===l&&c(this)&&(l=this);"number"===typeof l?l={op:"num",args:[l.toString()]}:"string"===typeof l&&(l={op:"str",args:[l]});assert("object"===typeof l,"node not an object");for(var s=l.op,t=l.args.length,v="",B=[],w=0;w<t;w++)v="str"===
l.op||"num"===l.op?v+(B[w]=l.args[w]):v+(B[w]=e(l.args[w]));l=s+t+v;t=f[l];void 0===t&&(d.push({op:s,args:B}),t=d.length-1,f[l]=t);return t};b.prototype.node=function(b){b=JSON.parse(JSON.stringify(d[b]));create(b);switch(b.op){case "num":case "str":break;default:for(var c=0;c<b.args.length;c++)b.args[c]=this.node(b.args[c])}return b};b.dumpAll=b.prototype.dumpAll=function(){var c="";forEach(d,function(d,f){c+="\n"+f+": "+b.dump(d)});return c};b.dump=b.prototype.dump=function l(b){if("string"===typeof b)var c=
'"'+b+'"';else if("number"===typeof b)c=b;else{for(var c='{ op: "'+b.op+'", args: [ ',d=0;d<b.args.length;d++)0<d&&(c+=" , "),c+=l(b.args[d]);c+=" ] }"}return c};return b}();var Model=function(){function b(){}b.fn={};b.env=d={};var c=[],d={};b.pushEnv=function(a){c.push(d);b.env=d=a};b.popEnv=function(){assert(0<c.length,"Empty envStack");b.env=d=c.pop()};var f=b.prototype=new Ast;Assert.reserveCodeRange(1E3,1999,"model");Assert.messages[1001]="Invalid syntax. '%1' expected, '%2' found.";Assert.messages[1002]="Square brackets can only be used to denote intervals.";Assert.messages[1003]="Extra characters in input at position: %1, lexeme: %2.";Assert.messages[1004]="Invalid character '%1' (%2) in input.";
var n=Assert.message;b.create=f.create=function v(a,c){assert(a,"Model.create() called with invalid argument "+a);if(a instanceof b)return c&&(a.location=c),a;if(!(this instanceof b))return(new b).create(a,c);var d=v(this);d.location=c;a="string"===typeof a?s(a,b.env).expr():JSON.parse(JSON.stringify(a));forEach(keys(b.fn),function(a,c){f.hasOwnProperty(a)||(f[a]=function(){var c=b.fn[a];if(1<arguments.length&&arguments[1]instanceof b)return c.apply(this,arguments);for(var d=[this],e=0;e<arguments.length;e++)d.push(arguments[e]);
return c.apply(this,d)})});forEach(keys(a),function(b,c){d[b]=a[b]});return d};b.fromLaTex=f.fromLaTex=function(a){assert("string"===typeof a,"Model.prototype.fromLaTex");return this?this.create(a):b.create(a)};f.toLaTex=function(b){return l(b)};var a={ADD:"+",SUB:"-",MUL:"times",DIV:"div",FRAC:"frac",EQL:"=",ATAN2:"atan2",SQRT:"sqrt",PM:"pm",SIN:"sin",COS:"cos",TAN:"tan",SEC:"sec",COT:"cot",CSC:"csc",LOG:"log",LN:"ln",LG:"lg",VAR:"var",NUM:"num",CST:"cst",COMMA:",",POW:"^",SUBSCRIPT:"_",ABS:"abs",
PAREN:"()",HIGHLIGHT:"hi",LT:"lt",LE:"le",GT:"gt",GE:"ge",INTERVAL:"interval",EXISTS:"exists",IN:"in",FORALL:"forall",LIM:"lim",EXP:"exp",TO:"to",SUM:"sum",INT:"int",PROD:"prod",PERCENT:"%",M:"M",RIGHTARROW:"->",FACT:"fact",BINOM:"binom",ROW:"row",COL:"col",COLON:"colon"};forEach(keys(a),function(c,d){b[c]=a[c]});var e={};e[a.ADD]="+";e[a.SUB]="-";e[a.MUL]="\\times";e[a.DIV]="\\div";e[a.FRAC]="\\frac";e[a.EQL]="=";e[a.ATAN2]="\\atan2";e[a.POW]="^";e[a.SUBSCRIPT]="_";e[a.PM]="\\pm";e[a.SIN]="\\sin";
e[a.COS]="\\cos";e[a.TAN]="\\tan";e[a.SEC]="\\sec";e[a.COT]="\\cot";e[a.CSC]="\\csc";e[a.LN]="\\ln";e[a.COMMA]=",";e[a.M]="\\M";e[a.BINOM]="\\binom";e[a.COLON]="\\colon";var l=function B(b){var c="";if("string"===typeof b)c=b;else if("number"===typeof b)c=b;else if("object"===typeof b){for(var d=[],f=0;f<b.args.length;f++)d[f]=B(b.args[f]);switch(b.op){case a.VAR:case a.CST:case a.NUM:c=b.args[0];break;case a.SUB:c=1===b.args.length?e[b.op]+" "+d[0]:d[0]+" "+e[b.op]+" "+d[1];break;case a.DIV:case a.PM:case a.EQL:c=
d[0]+" "+e[b.op]+" "+d[1];break;case a.POW:var f=b.args[0],k=b.args[1];if(f.args&&2===f.args.length||k.args&&2===k.args.length)if(f.op===a.ADD||f.op===a.SUB||f.op===a.MUL||f.op===a.DIV||f.op===a.SQRT)d[0]=" ("+d[0]+") ";c="{"+d[0]+"^{"+d[1]+"}}";break;case a.SIN:case a.COS:case a.TAN:case a.SEC:case a.COT:case a.CSC:case a.LN:case a.M:c="{"+e[b.op]+"{"+d[0]+"}}";break;case a.FRAC:c="\\dfrac{"+d[0]+"}{"+d[1]+"}";break;case a.BINOM:c="\\binom{"+d[0]+"}{"+d[1]+"}";break;case a.SQRT:switch(d.length){case 1:c=
"\\sqrt{"+d[0]+"}";break;case 2:c="\\sqrt["+d[0]+"]{"+d[1]+"}"}break;case a.MUL:var l,c="";forEach(b.args,function(f,k){if(f.args&&2<=f.args.length){if(f.op===a.ADD||f.op===a.SUB)d[k]="("+d[k]+")";0!==k&&"number"===typeof f&&(c+=e[b.op]+" ")}else f.op===a.PAREN||f.op===a.VAR||f.op===a.CST||"number"===typeof l&&"number"!==typeof f||0!==k&&(c+=" "+e[b.op]+" ");c+=d[k];l=f});break;case a.ADD:case a.COMMA:forEach(d,function(a,d){c=0===d?a:c+" "+e[b.op]+" "+a});break;default:assert(!1,"unimplemented eval operator")}}else assert(!1,
"invalid expression type");return c},s=function(c,d){function f(g,a,c){a&&(g=new BigDecimal(g.toString()),a=option("decimalPlaces"),!c||g.scale()>a)&&(g=g.setScale(a,BigDecimal.ROUND_HALF_UP));return{op:b.NUM,args:[g.toString()]}}function e(g,a){assert(1===a.length,"Wrong number of arguments for unary node");return g===b.ADD?a[0]:{op:g,args:a}}function l(b,a,c){assert(1<a.length,"Too few argument for binary node");var d=[];forEach(a,function(a){c&&a.op===b?d=d.concat(a.args):d.push(a)});return{op:b,
args:d}}function k(){m=ya;ya=K;m===K&&(m=u.start())}function p(b){var a=m;a!==b&&(b=String.fromCharCode(b),a=a?String.fromCharCode(a):"EOS",assert(!1,n(1001,[b,a])));k()}function q(){var g,a;switch(a=m){case 65:case 97:case C:g=[u.lexeme()];k();m===D&&(k(),g.push(q()));g={op:"var",args:g};break;case za:g={op:"num",args:[u.lexeme()]};k();break;case Aa:case L:p(a);var c=x();p(g=m===Y?Y:M);2===c.args.length||a!==L&&g!==M||assert(!1,n(1002));c.lbrk=a;c.rbrk=g;g=c;break;case Z:g=r();break;case Ba:k();
a=r().args[0];g=[];for(g.push(Ca());m===E;)k(),g.push(Ca());g={op:a,args:[1<g.length?{op:h[E],args:g}:g[0]]};p($);r();break;case N:p(N);a=O();p(N);g=e(b.ABS,[a]);break;case P:k();a=r();g=r();g={op:b.MUL,args:[a,{op:b.POW,args:[g,{op:b.NUM,args:["-1"]}]}]};break;case aa:k();g=r();c=r();a=e(b.FACT,[g]);g=l(b.POW,[l(b.MUL,[e(b.FACT,[c]),e(b.FACT,[l(b.ADD,[g,ba(c)])])]),f("-1")]);g=l(b.MUL,[a,g]);break;case ca:k();switch(m){case L:p(L);a=x();p(M);g=r();g={op:b.POW,args:[g,a,{op:b.NUM,args:["-1"]}]};break;
case Z:g=r();g={op:b.POW,args:[g,{op:b.NUM,args:["2"]},{op:b.NUM,args:["-1"]}]};break;default:assert(!1,n(1001,["{ or (",String.fromCharCode(m)]))}break;case da:case ea:case fa:case ga:case ha:case ia:k();for(g=[];m===Q;)k(),g.push(y());g.unshift({op:h[a],args:[q()]});return 1<g.length?{op:b.POW,args:g}:g[0];case ja:return k(),{op:b.LOG,args:[{op:b.VAR,args:["e"]},q()]};case ka:return k(),{op:b.LOG,args:[{op:b.NUM,args:["10"]},q()]};case la:return k(),g=[],m===D?(k(),g.push(q())):g.push({op:b.VAR,
args:["e"]}),g.push(q()),{op:b.LOG,args:g};case ma:return k(),g=[],p(D),g.push(q()),g.push(q()),{op:h[a],args:g};case na:case oa:case pa:return k(),g=[],m===D&&(k(),g.push(q()),p(Q),g.push(q())),g.push(x()),{op:h[a],args:g};case qa:return k(),{op:b.EXISTS,args:[z()]};case ra:return k(),{op:b.FORALL,args:[x()]};case sa:return k(),{op:b.EXP,args:[O()]};case Da:return k(),{op:b.M,args:[ta()]};default:assert(!1,"Model.primaryExpr() unexpected expression kind "+u.lexeme()),g=void 0}return g}function r(){p(Z);
var b=x();p(Ea);return b}function y(){var a,c;switch(a=m){case F:k();c=y();break;case A:case G:k();c=y();c={op:h[a],args:[c]};break;default:a=q();switch(m){case Fa:k();a={op:b.PERCENT,args:[a]};break;case Ga:k(),a={op:b.FACT,args:[a]}}c=a}return c}function s(){var a;for(a=[y()];m===D;)k(),a.push(y());a=1<a.length?{op:b.SUBSCRIPT,args:a}:a[0];for(var c=[a];(a=m)===Q;){k();var d;d=c[0];d=d.op!==b.VAR?!1:(d=b.env[d.args[0]])&&d.name?!0:!1;!(d||b.env.Au&&Ha(c[0]))||(a=m)!==F&&a!==A?(d=y(),!b.env.Au||
(a=m)!==F&&a!==A?c.push(d):(k(),c.push(e(a,[d])))):(k(),c.push(e(a,[f(1)])))}return 1<c.length?{op:b.POW,args:c}:c[0]}function Ha(a){return a.op!==b.VAR?!1:(a=b.env[a.args[0]])&&a.mass?!0:!1}function ta(){for(var a,c,d=[s()];(a=m)&&!Ia(a)&&!ua(a)&&a!==R&&a!==S&&a!==Ea&&a!==Y&&a!==M&&a!==H&&a!==I&&a!==N&&a!==E&&a!==J&&a!==$;){a!==T&&a!==U||k();c=s();if(a===U)c={op:b.POW,args:[c,{op:b.NUM,args:["-1"]}]};else{var f;if(f=b.env.Au)if(f=a===Aa)f=d[d.length-1],assert(!0,"Internal error in 'isVar()'"),f=
f.op!==b.VAR?!1:void 0===f?!0:"M"===f.args[0];f&&(d.pop(),c=e(b.M,[c]))}d.push(c)}return 1<d.length?b.env.Au&&Ha(d[1])?d[0].op===b.NUM?(a=[d.shift(),l(b.ADD,d)],l(b.MUL,a,void 0)):l(b.ADD,d):{op:b.MUL,args:d}:d[0]}function ba(a){if("number"===typeof a)return-a;if(1===a.args.length){if(a.op===b.SUB)return a.args[0];if(a.op===b.ADD)return a.args[0]=ba(a.args[0]),a}else if(a.op===b.MUL)return a.args.unshift({op:b.NUM,args:["-1"]}),a;return{op:b.MUL,args:[{op:b.NUM,args:["-1"]},a]}}function Ia(a){return a===
F||a===A||a===G}function O(){for(var a=ta(),c;Ia(c=m);){k();var d=ta();switch(c){case G:a={op:b.PM,args:[a,d]};break;case A:d=ba(d);default:a={op:b.ADD,args:[a,d]}}}return a}function ua(a){return a===I||a===V||a===W||a===X||a===va||a===wa||a===xa}function z(){if(m===S)var a={op:b.VAR,args:["_"]};else{for(var a=m,c=ua(a)?{op:b.VAR,args:["_"]}:O();ua(a=m);){k();var d=0===m?{op:b.VAR,args:["_"]}:O();switch(a){default:c={op:h[a],args:[c,d]}}}a=c}for(var f;(f=m)===S||f===H;)k(),c=0===m?{op:b.VAR,args:["_"]}:
z(),a={op:h[f],args:[a,c]};return a}function x(){for(var a=z(),b=[a];m===R;)k(),b.push(z());return 1<b.length?{op:h[R],args:b}:a}function Ca(){var a=[];for(a.push(z());m===J;)k(),a.push(z());return 1<a.length?{op:h[J],args:a}:a[0]}var K=0,F=43,Q=94,D=95,ea=261,ha=264,ia=265,U=47,S=61,P=256,ja=263,Z=123,N=124,L=91,Aa=40,T=42,za=48,G=258,Ea=125,M=93,Y=41,ga=262,da=259,ca=257,A=45,fa=260,C=97,R=44,ka=267,la=268,I=270,V=271,W=272,X=273,qa=274,va=275,ra=276,ma=277,sa=278,wa=279,na=280,oa=281,pa=282,Fa=
37,Da=283,H=284,Ga=33,aa=285,E=286,J=287,Ba=288,$=289,xa=58,h=[],m=K,ya=K;h[P]=a.FRAC;h[ca]=a.SQRT;h[F]=a.ADD;h[A]=a.SUB;h[G]=a.PM;h[Q]=a.POW;h[T]=a.MUL;h[U]=a.FRAC;h[da]=a.SIN;h[ea]=a.COS;h[fa]=a.TAN;h[ga]=a.SEC;h[ha]=a.COT;h[ia]=a.CSC;h[ja]=a.LN;h[ka]=a.LG;h[la]=a.LOG;h[S]=a.EQL;h[R]=a.COMMA;h[269]=a.TEXT;h[I]=a.LT;h[V]=a.LE;h[W]=a.GT;h[X]=a.GE;h[qa]=a.EXISTS;h[va]=a.IN;h[ra]=a.FORALL;h[ma]=a.LIM;h[sa]=a.EXP;h[wa]=a.TO;h[na]=a.SUM;h[oa]=a.INT;h[pa]=a.PROD;h[Da]=a.M;h[H]=a.RIGHTARROW;h[Ga]=a.FACT;
h[aa]=a.BINOM;h[E]=a.ROW;h[J]=a.COL;h[xa]=a.COLON;var u=function(a){function b(d){var e=String.fromCharCode(d);for(f+=e;97<=d&&122>=d||65<=d&&90>=d||39===d;){d=a.charCodeAt(c++);var e=String.fromCharCode(d),k=f+e;if(!some(h,function(a){return 0===a.indexOf(k)}))break;f+=e}for(;39===d;)d=a.charCodeAt(c++),e=String.fromCharCode(d),f+=e;c--;return C}var c=0,f="",e=[];e["\\cdot"]=T;e["\\times"]=T;e["\\div"]=U;e["\\dfrac"]=P;e["\\frac"]=P;e["\\sqrt"]=ca;e["\\pm"]=G;e["\\sin"]=da;e["\\cos"]=ea;e["\\tan"]=
fa;e["\\sec"]=ga;e["\\cot"]=ha;e["\\csc"]=ia;e["\\ln"]=ja;e["\\lg"]=ka;e["\\log"]=la;e["\\left"]=null;e["\\right"]=null;e["\\big"]=null;e["\\Big"]=null;e["\\bigg"]=null;e["\\Bigg"]=null;e["\\text"]=269;e["\\textrm"]=269;e["\\textit"]=269;e["\\textbf"]=269;e["\\lt"]=I;e["\\le"]=V;e["\\gt"]=W;e["\\ge"]=X;e["\\exists"]=qa;e["\\in"]=va;e["\\forall"]=ra;e["\\lim"]=ma;e["\\exp"]=sa;e["\\to"]=wa;e["\\sum"]=na;e["\\int"]=oa;e["\\prod"]=pa;e["\\%"]=Fa;e["\\rightarrow"]=H;e["\\binom"]=aa;e["\\begin"]=Ba;e["\\end"]=
$;e["\\colon"]=xa;var h=keys(d);return{start:function(){var d;for(f="";c<a.length;)switch(d=a.charCodeAt(c++)){case 32:case 9:case 10:case 13:continue;case 38:return J;case 92:f+=String.fromCharCode(d);if(92===a.charCodeAt(c))return c++,E;d=a.charCodeAt(c++);if(36===d)f=String.fromCharCode(d);else if(37===d)f+=String.fromCharCode(d);else{for(;97<=d&&122>=d||65<=d&&90>=d;)f+=String.fromCharCode(d),d=a.charCodeAt(c++);c--}d=e[f];if(void 0===d)d=C;else if(269===d){for(d=a.charCodeAt(c++);123!==d;)d=
a.charCodeAt(c++);f="";for(d=a.charCodeAt(c++);125!==d;)d=String.fromCharCode(d),f+=d,d=a.charCodeAt(c++);d=C}if(d)return d;f="";continue;case 45:if(62===a.charCodeAt(c))return c++,H;case 33:case 37:case 40:case 41:case 42:case 43:case 44:case 47:case 58:case 61:case 91:case 93:case 94:case 95:case 123:case 124:case 125:return f+=String.fromCharCode(d),d;case 36:return f+=String.fromCharCode(d),C;case 60:return 61===a.charCodeAt(c)?(c++,V):I;case 62:return 61===a.charCodeAt(c)?(c++,X):W;default:if(65<=
d&&90>=d||97<=d&&122>=d||39===d)return b(d);if(46===d||48<=d&&57>=d){for(;48<=d&&57>=d||46===d;)f+=String.fromCharCode(d),d=a.charCodeAt(c++);c--;return za}assert(!1,n(1004,[String.fromCharCode(d),d]));return 0}return 0},lexeme:function(){return f},pos:function(){return c}}}(c);return{expr:function(){m=u.start();var a=x();assert(!m,n(1003,[u.pos(),u.lexeme()]));return a}}};return b}();
