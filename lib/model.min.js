var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString),forEach=function(a,c,g){if(Array.prototype.forEach)return a.forEach(c);a=toObject(a);var b=splitString&&"[object String]"==_toString(a)?a.split(""):a,e=-1,d=b.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError;for(;++e<d;)e in b&&c.call(g,b[e],e,a)},filter=function(a,c,g){if(Array.prototype.filter)return a.filter(c);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=
a.length>>>0,d=[],f;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var m=0;m<e;m++)m in a&&(f=a[m],c.call(g,f,m,b)&&d.push(f));return d},every=function(a,c,g){if(Array.prototype.every)return a.every(c,g);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=a.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var d=0;d<e;d++)if(d in a&&!c.call(g,a[d],d,b))return!1;return!0},some=function(a,
c,g){if(Array.prototype.some)return a.some(c,g);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=a.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var d=0;d<e;d++)if(d in a&&c.call(g,a[d],d,b))return!0;return!1},indexOf=function(a,c){var g=arguments[2];if(Array.prototype.indexOf)return a.indexOf(c,g);var b=splitString&&"[object String]"==_toString(a)?a.split(""):toObject(a),e=b.length>>>0;if(!e)return-1;var d=0;2<
arguments.length&&(d=toInteger(g));for(d=0<=d?d:Math.max(0,e+d);d<e;d++)if(d in b&&b[d]===c)return d;return-1},keys=function(a){if(Object.keys)return Object.keys(a);var c=!0,g="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),b=g.length,e;for(e in{toString:null})c=!1;if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on a non-object");e=[];for(var d in a)owns(a,d)&&e.push(d);if(c)for(c=0;c<b;c++)d=
g[c],owns(a,d)&&e.push(d);return e},toObject=function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return Object(a)},prototypeOfObject=Object.prototype,_toString=function(a){return prototypeOfObject.toString.apply(a)},owns=function(a,c){return prototypeOfObject.hasOwnProperty.call(a,c)};var ASSERT=!0,assert=function(){return ASSERT?function(a,c){void 0===c&&(c="failed!");if(!a)try{throw Error(c);}catch(g){throw g.message+"\n"+g.stack;}}:function(){}}(),message=function(a,c){var g=Assert.messages[a];c&&forEach(c,function(a,e){g=g.replace("%"+(e+1),a)});return a+": "+g},reserveCodeRange=function(a,c,g){assert(a<=c,"Invalid code range");var b=every(Assert.reservedCodes,function(b){return c<b.first||a>b.last});assert(b,"Conflicting request for error code range");Assert.reservedCodes.push({first:a,
last:c,name:g})},Assert={assert:assert,message:message,messages:{},reserveCodeRange:reserveCodeRange,reservedCodes:[]};var TRACE=!0,global=this,trace=function(){return TRACE?function(a){if(global.console&&global.console.log)console.log(a);else if(global.print)print(a);else throw"No trace function defined!";}:function(){}}();var Ast=function(){function a(){}function c(a){void 0===a&&(a=this);return a.op&&a.args}var g=["unused"],b={};a.clearPool=function(){g=["unused"];b={}};a.prototype.create=function(a,b){var c=Object.create(this);"string"===typeof a?(c.op=a,c.args=b instanceof Array?b:[]):null!==a&&"object"===typeof a&&forEach(keys(a),function(b,d){c[b]=a[b]});return c};a.prototype.arg=function(a){if(!c(this))throw"Malformed node";this.args.push(a);return this};a.prototype.argN=function(a,b){if(!c(this))throw"Malformed node";
if(void 0===b)return this.args[a];this.args[a]=b;return this};a.prototype.args=function(a){if(!c(this))throw"Malformed node";if(void 0===a)return this.args;this.args=a;return this};a.prototype.isNode=c;a.intern=a.prototype.intern=function d(f){this instanceof a&&void 0===f&&c(this)&&(f=this);"number"===typeof f?f={op:"num",args:[f]}:"string"===typeof f&&(f={op:"str",args:[f]});assert("object"===typeof f,"node not an object");for(var m=f.op,n=f.args.length,s="",B=[],q=0;q<n;q++)s="num"===f.op||"str"===
f.op?s+(B[q]=f.args[q]):s+(B[q]=d(f.args[q]));f=m+n+s;n=b[f];void 0===n&&(g.push({op:m,args:B}),n=g.length-1,b[f]=n);return n};a.prototype.node=function(a){a=JSON.parse(JSON.stringify(g[a]));var b=this.create(a);switch(a.op){case "num":case "str":a=a.args[0];break;default:for(var c=0;c<a.args.length;c++)a.args[c]=b(a.args[c])}return a};a.dumpAll=a.prototype.dumpAll=function(){var b="";forEach(g,function(c,m){b+="\n"+m+": "+a.dump(c)});return b};a.dump=a.prototype.dump=function f(a){if("string"===
typeof a)var b='"'+a+'"';else if("number"===typeof a)b=a;else{for(var b='{ op: "'+a.op+'", args: [ ',c=0;c<a.args.length;c++)0<c&&(b+=" , "),b+=f(a.args[c]);b+=" ] }"}return b};return a}();var Model=function(){function a(){}a.fn={};var c=a.prototype=new Ast;Assert.reserveCodeRange(1E3,1999,"model");Assert.messages[1001]="Invalid syntax. '%1' expected, '%2' found.";Assert.messages[1002]="Square brackets can only be used to denote intervals.";Assert.messages[1003]="Extra characters in input at position: %1, lexeme: %2.";Assert.messages[1004]="Invalid character '%1' (%2) in input.";var g=Assert.message;a.create=c.create=function(b){assert(b,"Model.create() called with invalid argument "+
b);if(b instanceof a)return b;if(!(this instanceof a))return(new a).create(b);var e=Object.create(this);b="string"===typeof b?f(b).expr():JSON.parse(JSON.stringify(b));forEach(keys(a.fn),function(b,e){c.hasOwnProperty(b)||(c[b]=function(){var c=a.fn[b];if(1<arguments.length&&arguments[1]instanceof a)return c.apply(this,arguments);for(var e=[this],d=0;d<arguments.length;d++)e.push(arguments[d]);return c.apply(this,e)})});forEach(keys(b),function(a,c){e[a]=b[a]});return e};a.fromLaTex=c.fromLaTex=function(b){assert("string"===
typeof b,"Model.prototype.fromLaTex");return this?this.create(b):a.create(b)};c.toLaTex=function(a){return d(a)};var b={ADD:"+",SUB:"-",MUL:"times",DIV:"div",FRAC:"frac",EQL:"=",ATAN2:"atan2",SQRT:"sqrt",PM:"pm",SIN:"sin",COS:"cos",TAN:"tan",SEC:"sec",COT:"cot",CSC:"csc",LN:"ln",VAR:"var",NUM:"num",CST:"cst",COMMA:",",POW:"^",ABS:"abs",PAREN:"()",HIGHLIGHT:"hi",INTERVAL:"interval"};forEach(keys(b),function(c,e){a[c]=b[c]});var e={};e[b.ADD]="+";e[b.SUB]="-";e[b.MUL]="\\times";e[b.DIV]="\\div";e[b.FRAC]=
"\\frac";e[b.EQL]="=";e[b.ATAN2]="\\atan2";e[b.POW]="^";e[b.PM]="\\pm";e[b.SIN]="\\sin";e[b.COS]="\\cos";e[b.TAN]="\\tan";e[b.SEC]="\\sec";e[b.COT]="\\cot";e[b.CSC]="\\csc";e[b.LN]="\\ln";e[b.COMMA]=",";var d=function n(a){var c="";if("string"===typeof a)c=a;else if("number"===typeof a)c=a;else if("object"===typeof a){for(var d=[],g=0;g<a.args.length;g++)d[g]=n(a.args[g]);switch(a.op){case b.VAR:case b.CST:case b.NUM:c=a.args[0];break;case b.SUB:c=1===a.args.length?e[a.op]+" "+d[0]:d[0]+" "+e[a.op]+
" "+d[1];break;case b.DIV:case b.PM:case b.EQL:c=d[0]+" "+e[a.op]+" "+d[1];break;case b.POW:var g=a.args[0],f=a.args[1];if(g.args&&2===g.args.length||f.args&&2===f.args.length)if(g.op===b.ADD||g.op===b.SUB||g.op===b.MUL||g.op===b.DIV||g.op===b.SQRT)d[0]=" ("+d[0]+") ";c="{"+d[0]+"^{"+d[1]+"}}";break;case b.SIN:case b.COS:case b.TAN:case b.SEC:case b.COT:case b.CSC:case b.LN:c="{"+e[a.op]+"{"+d[0]+"}}";break;case b.FRAC:c="\\dfrac{"+d[0]+"}{"+d[1]+"}";break;case b.SQRT:switch(d.length){case 1:c="\\sqrt{"+
d[0]+"}";break;case 2:c="\\sqrt["+d[0]+"]{"+d[1]+"}"}break;case b.MUL:var r,c="";forEach(a.args,function(g,f){if(g.args&&2<=g.args.length){if(g.op===b.ADD||g.op===b.SUB)d[f]="("+d[f]+")";0!==f&&"number"===typeof g&&(c+=e[a.op]+" ")}else g.op===b.PAREN||g.op===b.VAR||g.op===b.CST||"number"===typeof r&&"number"!==typeof g||0!==f&&(c+=" "+e[a.op]+" ");c+=d[f];r=g});break;case b.ADD:case b.COMMA:forEach(d,function(b,d){c=0===d?b:c+" "+e[a.op]+" "+b});break;default:assert(!1,"unimplemented eval operator")}}else assert(!1,
"invalid expression type");return c},f=function(b){function c(){l=U;U=t;l===t&&(l=p.start())}function d(a){var b=l;b!==a&&(a=String.fromCharCode(a),b=b?String.fromCharCode(b):"EOS",assert(!1,g(1001,[a,b])));c()}function e(){d(C);var a=u();d(V);return a}function f(){var b;switch(l){case D:c();b=f();break;case v:c();b=f();b={op:a.SUB,args:[b]};break;default:var h;switch(b=l){case 65:case w:h={op:"var",args:[p.lexeme()]};c();break;case 97:h={op:"var",args:[p.lexeme()]};c();break;case W:h={op:"num",args:[p.lexeme()]};
c();break;case $:d(b);h=u();d(tk2=l===E?E:x);2===h.args.length||b!==F&&tk2!==x||assert(!1,g(1002));h.lbrk=b;h.rbrk=tk2;break;case C:h=e();break;case y:c();b=e();h=e();h={op:a.MUL,args:[b,{op:a.POW,args:[h,{op:a.NUM,args:["-1"]}]}]};break;case G:c();switch(l){case F:d(F);b=u();d(x);h=e();h={op:a.POW,args:[h,b,{op:a.NUM,args:["-1"]}]};break;case C:h=e();h=h.op===a.POW?{op:a.POW,args:[h.args[0],{op:a.MUL,args:[h.args[1],{op:a.POW,args:[{op:a.NUM,args:["2"]},{op:a.NUM,args:["-1"]}]}]}]}:{op:a.POW,args:[h,
{op:a.NUM,args:["2"]},{op:a.NUM,args:["-1"]}]};break;default:assert(!1,g(1001,["{ or (",String.fromCharCode(l)]))}break;case H:case I:case J:case K:case L:case M:case N:c();h={op:k[b],args:[e()]};break;default:assert(!1,"Model.primaryExpr() unexpected expression kind"),h=void 0}b=h}return b}function R(){for(var b=[f()];l===X;)c(),b.push(f());return 1<b.length?{op:a.POW,args:b}:b[0]}function r(){for(var b,d,e=[R()];(b=l)&&!T(b)&&b!==z&&b!==O&&b!==V&&b!==E&&b!==x;)b===P||b===A?(op=k[b],c()):op=a.MUL,
d=R(),b===A&&(d={op:a.POW,args:[d,{op:a.NUM,args:["-1"]}]}),e.push(d);return 1<e.length?{op:a.MUL,args:e}:e[0]}function S(b){if("number"===typeof b)return-b;if(1===b.args.length){if(b.op===a.SUB)return b.args[0];if(b.op===a.ADD)return b.args[0]=S(b.args[0]),b;if(b.op===a.NUM||b.op===a.VAR)return{op:a.MUL,args:[{op:a.NUM,args:["-1"]},b]}}else if(2===b.args.length)return{op:a.SUB,args:[b]};assert(!1,"Unhandled case in negate() op="+b.op+" n.args.length="+b.args.length);return{op:a.SUB,args:[b]}}function T(a){return a===
D||a===v||a===Q}function Y(){for(var b=r(),d;T(d=l);){c();var e=r();switch(d){case v:e=S(e);default:b={op:a.ADD,args:[b,e]}}}return b}function Z(){for(var a=Y(),b;(b=l)===O;){c();var d=Y(),a={op:k[b],args:[a,d]}}return a}function u(){for(var a=Z(),b=[a];l===z;)c(),b.push(Z());return 1<b.length?{op:k[z],args:b}:a}var t=0,D=43,X=94,I=261,L=264,M=265,A=47,O=61,y=256,N=263,C=123,F=91,$=40,P=42,W=48,Q=258,V=125,x=93,E=41,K=262,H=259,G=257,v=45,J=260,w=97,z=44,k=[],l=t,U=t;k[y]="frac";k[G]="sqrt";k[D]=
"+";k[v]="-";k[Q]="pm";k[X]="^";k[P]="times";k[A]="frac";k[H]="sin";k[I]="cos";k[J]="tan";k[K]="sec";k[L]="cot";k[M]="csc";k[N]="ln";k[O]="=";k[z]=",";var p=function(a){function b(e){var g=String.fromCharCode(e);for(d+=g;97<=e&&122>=e;){e=a.charCodeAt(c++);var g=String.fromCharCode(e),h=d+g;if(!some(f,function(a){return 0===a.indexOf(h)}))break;d+=g}c--;return w}var c=0,d="",e=[];e["\\times"]=P;e["\\div"]=A;e["\\dfrac"]=y;e["\\frac"]=y;e["\\sqrt"]=G;e["\\pm"]=Q;e["\\sin"]=H;e["\\cos"]=I;e["\\tan"]=
J;e["\\sec"]=K;e["\\cot"]=L;e["\\csc"]=M;e["\\ln"]=N;var f="g cg kg mg ng m cm km mm nm L mL s cs ks ms ns in ft mi fl cup pt qt gal oz lb".split(" ");return{start:function(){var f;for(d="";c<a.length;)switch(f=a.charCodeAt(c++)){case 32:case 9:case 10:case 13:continue;case 92:d+=String.fromCharCode(f);for(f=a.charCodeAt(c++);97<=f&&122>=f;)d+=String.fromCharCode(f),f=a.charCodeAt(c++);c--;f=e[d];void 0===f&&(f=w);return f;case 40:case 41:case 42:case 43:case 44:case 45:case 47:case 61:case 91:case 93:case 94:case 123:case 125:return d+=
String.fromCharCode(f),f;default:if(65<=f&&90>=f)return d+=String.fromCharCode(f),w;if(97<=f&&122>=f)return b(f);if(46===f||48<=f&&57>=f){for(;48<=f&&57>=f||46===f;)d+=String.fromCharCode(f),f=a.charCodeAt(c++);c--;return W}assert(!1,g(1004,[String.fromCharCode(f),f]));return 0}return 0},lexeme:function(){return d},pos:function(){return c}}}(b);return{expr:function(){l=p.start();var a=u();assert(!l,g(1003,[p.pos(),p.lexeme()]));return a}}};return a}();
