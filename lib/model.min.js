var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString),forEach=function(a,c,f){if(Array.prototype.forEach)return a.forEach(c);a=toObject(a);var b=splitString&&"[object String]"==_toString(a)?a.split(""):a,e=-1,d=b.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError;for(;++e<d;)e in b&&c.call(f,b[e],e,a)},filter=function(a,c,f){if(Array.prototype.filter)return a.filter(c);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=
a.length>>>0,d=[],n;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var h=0;h<e;h++)h in a&&(n=a[h],c.call(f,n,h,b)&&d.push(n));return d},every=function(a,c,f){if(Array.prototype.every)return a.every(c,f);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=a.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var d=0;d<e;d++)if(d in a&&!c.call(f,a[d],d,b))return!1;return!0},some=function(a,
c,f){if(Array.prototype.some)return a.some(c,f);var b=toObject(a);a=splitString&&"[object String]"==_toString(a)?a.split(""):b;var e=a.length>>>0;if("[object Function]"!=_toString(c))throw new TypeError(c+" is not a function");for(var d=0;d<e;d++)if(d in a&&c.call(f,a[d],d,b))return!0;return!1},indexOf=function(a,c){var f=arguments[2];if(Array.prototype.indexOf)return a.indexOf(c,f);var b=splitString&&"[object String]"==_toString(a)?a.split(""):toObject(a),e=b.length>>>0;if(!e)return-1;var d=0;2<
arguments.length&&(d=toInteger(f));for(d=0<=d?d:Math.max(0,e+d);d<e;d++)if(d in b&&b[d]===c)return d;return-1},keys=function(a){if(Object.keys)return Object.keys(a);var c=!0,f="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),b=f.length,e;for(e in{toString:null})c=!1;if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on a non-object");e=[];for(var d in a)owns(a,d)&&e.push(d);if(c)for(c=0;c<b;c++)d=
f[c],owns(a,d)&&e.push(d);return e},toObject=function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return Object(a)},prototypeOfObject=Object.prototype,_toString=function(a){return prototypeOfObject.toString.apply(a)},owns=function(a,c){return prototypeOfObject.hasOwnProperty.call(a,c)},create=function(a){if(Object.create)return Object.create(a);var c=function(){};if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");c.prototype=a;return new c};var ASSERT=!0,assert=function(){return ASSERT?function(a,c){void 0===c&&(c="failed!");if(!a)try{throw Error(c);}catch(f){throw f.message+"\n"+f.stack;}}:function(){}}(),message=function(a,c){var f=Assert.messages[a];c&&forEach(c,function(a,c){f=f.replace("%"+(c+1),a)});return a+": "+f},reserveCodeRange=function(a,c,f){assert(a<=c,"Invalid code range");var b=every(Assert.reservedCodes,function(b){return c<b.first||a>b.last});assert(b,"Conflicting request for error code range");Assert.reservedCodes.push({first:a,
last:c,name:f})},Assert={assert:assert,message:message,messages:{},reserveCodeRange:reserveCodeRange,reservedCodes:[]};var TRACE=!1,global=this,trace=function(){return TRACE?function(a){if(global.console&&global.console.log)console.log(a);else if(global.print)print(a);else throw"No trace function defined!";}:function(){}}();var Ast=function(){function a(){}function c(a){void 0===a&&(a=this);return a.op&&a.args}var f=["unused"],b={};a.clearPool=function(){f=["unused"];b={}};a.prototype.create=function d(a,b){var c=d(this);"string"===typeof a?(c.op=a,c.args=b instanceof Array?b:[]):null!==a&&"object"===typeof a&&forEach(keys(a),function(b,q){c[b]=a[b]});return c};a.prototype.arg=function(a){if(!c(this))throw"Malformed node";this.args.push(a);return this};a.prototype.argN=function(a,b){if(!c(this))throw"Malformed node";
if(void 0===b)return this.args[a];this.args[a]=b;return this};a.prototype.args=function(a){if(!c(this))throw"Malformed node";if(void 0===a)return this.args;this.args=a;return this};a.prototype.isNode=c;a.intern=a.prototype.intern=function n(h){this instanceof a&&void 0===h&&c(this)&&(h=this);"number"===typeof h?h={op:"num",args:[h]}:"string"===typeof h&&(h={op:"str",args:[h]});assert("object"===typeof h,"node not an object");for(var u=h.op,p=h.args.length,q="",D=[],s=0;s<p;s++)q="num"===h.op||"str"===
h.op?q+(D[s]=h.args[s]):q+(D[s]=n(h.args[s]));h=u+p+q;p=b[h];void 0===p&&(f.push({op:u,args:D}),p=f.length-1,b[h]=p);return p};a.prototype.node=function(a){a=JSON.parse(JSON.stringify(f[a]));var b=this.create(a);switch(a.op){case "num":case "str":a=a.args[0];break;default:for(var c=0;c<a.args.length;c++)a.args[c]=b(a.args[c])}return a};a.dumpAll=a.prototype.dumpAll=function(){var b="";forEach(f,function(c,f){b+="\n"+f+": "+a.dump(c)});return b};a.dump=a.prototype.dump=function h(a){if("string"===
typeof a)var b='"'+a+'"';else if("number"===typeof a)b=a;else{for(var b='{ op: "'+a.op+'", args: [ ',c=0;c<a.args.length;c++)0<c&&(b+=" , "),b+=h(a.args[c]);b+=" ] }"}return b};return a}();var Model=function(){function a(){}a.fn={};var c=a.prototype=new Ast;Assert.reserveCodeRange(1E3,1999,"model");Assert.messages[1001]="Invalid syntax. '%1' expected, '%2' found.";Assert.messages[1002]="Square brackets can only be used to denote intervals.";Assert.messages[1003]="Extra characters in input at position: %1, lexeme: %2.";Assert.messages[1004]="Invalid character '%1' (%2) in input.";var f=Assert.message;a.create=c.create=function u(b){assert(b,"Model.create() called with invalid argument "+
b);if(b instanceof a)return b;if(!(this instanceof a))return(new a).create(b);var e=u(this);b="string"===typeof b?n(b).expr():JSON.parse(JSON.stringify(b));forEach(keys(a.fn),function(b,e){c.hasOwnProperty(b)||(c[b]=function(){var c=a.fn[b];if(1<arguments.length&&arguments[1]instanceof a)return c.apply(this,arguments);for(var e=[this],q=0;q<arguments.length;q++)e.push(arguments[q]);return c.apply(this,e)})});forEach(keys(b),function(a,c){e[a]=b[a]});return e};a.fromLaTex=c.fromLaTex=function(b){assert("string"===
typeof b,"Model.prototype.fromLaTex");return this?this.create(b):a.create(b)};c.toLaTex=function(a){return d(a)};var b={ADD:"+",SUB:"-",MUL:"times",DIV:"div",FRAC:"frac",EQL:"=",ATAN2:"atan2",SQRT:"sqrt",PM:"pm",SIN:"sin",COS:"cos",TAN:"tan",SEC:"sec",COT:"cot",CSC:"csc",LN:"ln",VAR:"var",NUM:"num",CST:"cst",COMMA:",",POW:"^",ABS:"abs",PAREN:"()",HIGHLIGHT:"hi",INTERVAL:"interval"};forEach(keys(b),function(c,e){a[c]=b[c]});var e={};e[b.ADD]="+";e[b.SUB]="-";e[b.MUL]="\\times";e[b.DIV]="\\div";e[b.FRAC]=
"\\frac";e[b.EQL]="=";e[b.ATAN2]="\\atan2";e[b.POW]="^";e[b.PM]="\\pm";e[b.SIN]="\\sin";e[b.COS]="\\cos";e[b.TAN]="\\tan";e[b.SEC]="\\sec";e[b.COT]="\\cot";e[b.CSC]="\\csc";e[b.LN]="\\ln";e[b.COMMA]=",";var d=function p(a){var c="";if("string"===typeof a)c=a;else if("number"===typeof a)c=a;else if("object"===typeof a){for(var f=[],d=0;d<a.args.length;d++)f[d]=p(a.args[d]);switch(a.op){case b.VAR:case b.CST:case b.NUM:c=a.args[0];break;case b.SUB:c=1===a.args.length?e[a.op]+" "+f[0]:f[0]+" "+e[a.op]+
" "+f[1];break;case b.DIV:case b.PM:case b.EQL:c=f[0]+" "+e[a.op]+" "+f[1];break;case b.POW:var d=a.args[0],n=a.args[1];if(d.args&&2===d.args.length||n.args&&2===n.args.length)if(d.op===b.ADD||d.op===b.SUB||d.op===b.MUL||d.op===b.DIV||d.op===b.SQRT)f[0]=" ("+f[0]+") ";c="{"+f[0]+"^{"+f[1]+"}}";break;case b.SIN:case b.COS:case b.TAN:case b.SEC:case b.COT:case b.CSC:case b.LN:c="{"+e[a.op]+"{"+f[0]+"}}";break;case b.FRAC:c="\\dfrac{"+f[0]+"}{"+f[1]+"}";break;case b.SQRT:switch(f.length){case 1:c="\\sqrt{"+
f[0]+"}";break;case 2:c="\\sqrt["+f[0]+"]{"+f[1]+"}"}break;case b.MUL:var t,c="";forEach(a.args,function(d,p){if(d.args&&2<=d.args.length){if(d.op===b.ADD||d.op===b.SUB)f[p]="("+f[p]+")";0!==p&&"number"===typeof d&&(c+=e[a.op]+" ")}else d.op===b.PAREN||d.op===b.VAR||d.op===b.CST||"number"===typeof t&&"number"!==typeof d||0!==p&&(c+=" "+e[a.op]+" ");c+=f[p];t=d});break;case b.ADD:case b.COMMA:forEach(f,function(b,d){c=0===d?b:c+" "+e[a.op]+" "+b});break;default:assert(!1,"unimplemented eval operator")}}else assert(!1,
"invalid expression type");return c},n=function(b){function c(){m=W;W=v;m===v&&(m=r.start())}function d(a){var b=m;b!==a&&(a=String.fromCharCode(a),b=b?String.fromCharCode(b):"EOS",assert(!1,f(1001,[a,b])));c()}function e(){d(E);var a=w();d(X);return a}function n(){var b;switch(m){case F:c();b=n();break;case x:c();b=n();b={op:a.SUB,args:[b]};break;default:var k;switch(b=m){case 65:case y:k={op:"var",args:[r.lexeme()]};c();break;case 97:k={op:"var",args:[r.lexeme()]};c();break;case Y:k={op:"num",args:[r.lexeme()]};
c();break;case ba:d(b);k=w();d(tk2=m===G?G:z);2===k.args.length||b!==H&&tk2!==z||assert(!1,f(1002));k.lbrk=b;k.rbrk=tk2;break;case E:k=e();break;case A:c();b=e();k=e();k={op:a.MUL,args:[b,{op:a.POW,args:[k,{op:a.NUM,args:["-1"]}]}]};break;case I:c();switch(m){case H:d(H);b=w();d(z);k=e();k={op:a.POW,args:[k,b,{op:a.NUM,args:["-1"]}]};break;case E:k=e();k=k.op===a.POW?{op:a.POW,args:[k.args[0],{op:a.MUL,args:[k.args[1],{op:a.POW,args:[{op:a.NUM,args:["2"]},{op:a.NUM,args:["-1"]}]}]}]}:{op:a.POW,args:[k,
{op:a.NUM,args:["2"]},{op:a.NUM,args:["-1"]}]};break;default:assert(!1,f(1001,["{ or (",String.fromCharCode(m)]))}break;case J:case K:case L:case M:case N:case O:case P:c();k={op:l[b],args:[e()]};break;default:assert(!1,"Model.primaryExpr() unexpected expression kind"),k=void 0}b=k}return b}function T(){for(var b=[n()];m===Z;)c(),b.push(n());return 1<b.length?{op:a.POW,args:b}:b[0]}function t(){for(var b,d,f=[T()];(b=m)&&!V(b)&&b!==B&&b!==Q&&b!==X&&b!==G&&b!==z;)b!==R&&b!==C||c(),d=T(),b===C&&(d=
{op:a.POW,args:[d,{op:a.NUM,args:["-1"]}]}),f.push(d);return 1<f.length?{op:a.MUL,args:f}:f[0]}function U(b){if("number"===typeof b)return-b;if(1===b.args.length){if(b.op===a.SUB)return b.args[0];if(b.op===a.ADD)return b.args[0]=U(b.args[0]),b;if(b.op===a.NUM||b.op===a.VAR)return{op:a.MUL,args:[{op:a.NUM,args:["-1"]},b]}}else if(2===b.args.length)return{op:a.SUB,args:[b]};assert(!1,"Unhandled case in negate() op="+b.op+" n.args.length="+b.args.length);return{op:a.SUB,args:[b]}}function V(a){return a===
F||a===x||a===S}function $(){for(var b=t(),d;V(d=m);){c();var f=t();switch(d){case x:f=U(f);default:b={op:a.ADD,args:[b,f]}}}return b}function aa(){for(var a=$(),b;(b=m)===Q;){c();var d=$(),a={op:l[b],args:[a,d]}}return a}function w(){for(var a=aa(),b=[a];m===B;)c(),b.push(aa());return 1<b.length?{op:l[B],args:b}:a}var v=0,F=43,Z=94,K=261,N=264,O=265,C=47,Q=61,A=256,P=263,E=123,H=91,ba=40,R=42,Y=48,S=258,X=125,z=93,G=41,M=262,J=259,I=257,x=45,L=260,y=97,B=44,l=[],m=v,W=v;l[A]="frac";l[I]="sqrt";l[F]=
"+";l[x]="-";l[S]="pm";l[Z]="^";l[R]="times";l[C]="frac";l[J]="sin";l[K]="cos";l[L]="tan";l[M]="sec";l[N]="cot";l[O]="csc";l[P]="ln";l[Q]="=";l[B]=",";var r=function(a){function b(e){var f=String.fromCharCode(e);for(d+=f;97<=e&&122>=e;){e=a.charCodeAt(c++);var f=String.fromCharCode(e),k=d+f;if(!some(l,function(a){return 0===a.indexOf(k)}))break;d+=f}c--;return y}var c=0,d="",e=[];e["\\times"]=R;e["\\div"]=C;e["\\dfrac"]=A;e["\\frac"]=A;e["\\sqrt"]=I;e["\\pm"]=S;e["\\sin"]=J;e["\\cos"]=K;e["\\tan"]=
L;e["\\sec"]=M;e["\\cot"]=N;e["\\csc"]=O;e["\\ln"]=P;e["\\left"]=null;e["\\right"]=null;e["\\big"]=null;e["\\Big"]=null;e["\\bigg"]=null;e["\\Bigg"]=null;var l="g cg kg mg ng m cm km mm nm L mL s cs ks ms ns in ft mi fl cup pt qt gal oz lb".split(" ");return{start:function(){var g;for(d="";c<a.length;)switch(g=a.charCodeAt(c++)){case 32:case 9:case 10:case 13:continue;case 92:d+=String.fromCharCode(g);for(g=a.charCodeAt(c++);97<=g&&122>=g||65<=g&&90>=g;)d+=String.fromCharCode(g),g=a.charCodeAt(c++);
c--;g=e[d];void 0===g&&(g=y);if(g)return g;d="";continue;case 40:case 41:case 42:case 43:case 44:case 45:case 47:case 61:case 91:case 93:case 94:case 123:case 125:return d+=String.fromCharCode(g),g;default:if(65<=g&&90>=g)return d+=String.fromCharCode(g),y;if(97<=g&&122>=g)return b(g);if(46===g||48<=g&&57>=g){for(;48<=g&&57>=g||46===g;)d+=String.fromCharCode(g),g=a.charCodeAt(c++);c--;return Y}assert(!1,f(1004,[String.fromCharCode(g),g]));return 0}return 0},lexeme:function(){return d},pos:function(){return c}}}(b);
return{expr:function(){m=r.start();var a=w();assert(!m,f(1003,[r.pos(),r.lexeme()]));return a}}};return a}();
