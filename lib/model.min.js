var ASSERT=!0,assert=function(){return ASSERT?function(b,e){void 0===e&&(e="failed!");if(!b)try{throw Error(e);}catch(h){throw h.message+"\n"+h.stack;}}:function(){}}(),message=function(b,e){var h=Assert.messages[b];e&&forEach(e,function(b,d){h=h.replace("%"+(d+1),b)});return b+": "+h},reserveCodeRange=function(b,e,h){assert(b<=e,"Invalid code range");var a=every(Assert.reservedCodes,function(a){return e<a.first||b>a.last});assert(a,"Conflicting request for error code range");Assert.reservedCodes.push({first:b,
last:e,name:h})},Assert={assert:assert,message:message,messages:{},reserveCodeRange:reserveCodeRange,reservedCodes:[]};var TRACE=!0,global=this,trace=function(){return TRACE?function(b){if(global.console&&global.console.log)console.log(b);else if(global.print)print(b);else throw"No trace function defined!";}:function(){}}();var Ast=function(){function b(){}function e(b){void 0===b&&(b=this);return b.op&&b.args}var h=["unused"],a={};b.clearPool=function(){h=["unused"];a={}};b.prototype.create=function(b,a){var c=Object.create(this);"string"===typeof b?(c.op=b,c.args=a instanceof Array?a:[]):null!==b&&"object"===typeof b&&forEach(keys(b),function(a,n){c[a]=b[a]});return c};b.prototype.arg=function(b){if(!e(this))throw"Malformed node";this.args.push(b);return this};b.prototype.argN=function(b,a){if(!e(this))throw"Malformed node";
if(void 0===a)return this.args[b];this.args[b]=a;return this};b.prototype.args=function(b){if(!e(this))throw"Malformed node";if(void 0===b)return this.args;this.args=b;return this};b.prototype.isNode=e;b.intern=b.prototype.intern=function s(c){this instanceof b&&void 0===c&&e(this)&&(c=this);"number"===typeof c?c={op:"num",args:[c]}:"string"===typeof c&&(c={op:"str",args:[c]});assert("object"===typeof c,"node not an object");for(var p=c.op,n=c.args.length,q="",g=[],f=0;f<n;f++)q="num"===c.op||"str"===
c.op?q+(g[f]=c.args[f]):q+(g[f]=s(c.args[f]));c=p+n+q;n=a[c];void 0===n&&(h.push({op:p,args:g}),n=h.length-1,a[c]=n);return n};b.prototype.node=function(b){b=JSON.parse(JSON.stringify(h[b]));var a=this.create(b);switch(b.op){case "num":case "str":b=b.args[0];break;default:for(var p=0;p<b.args.length;p++)b.args[p]=a(b.args[p])}return b};b.dumpAll=b.prototype.dumpAll=function(){var a="";forEach(h,function(c,p){a+="\n"+p+": "+b.dump(c)});return a};b.dump=b.prototype.dump=function c(b){if("string"===
typeof b)var a='"'+b+'"';else if("number"===typeof b)a=b;else{for(var a='{ op: "'+b.op+'", args: [ ',q=0;q<b.args.length;q++)0<q&&(a+=" , "),a+=c(b.args[q]);a+=" ] }"}return a};return b}();var Model=function(){function b(){}b.fn={};var e=b.prototype=new Ast;Assert.reserveCodeRange(1E3,1999,"model");Assert.messages[1001]="Invalid syntax. '%1' expected, '%2' found.";Assert.messages[1002]="Square brackets can only be used to denote intervals.";Assert.messages[1003]="Extra characters in input at position: %1, lexeme: %2.";Assert.messages[1004]="Invalid character '%1' (%2) in input.";var h=Assert.message;b.create=e.create=function(a){assert(a,"Model.create() called with invalid argument "+
a);if(a instanceof b)return a;if(!(this instanceof b))return(new b).create(a);var d=Object.create(this);a="string"===typeof a?c(a).expr():JSON.parse(JSON.stringify(a));forEach(keys(b.fn),function(a,g){e.hasOwnProperty(a)||(e[a]=function(){var f=b.fn[a];if(1<arguments.length&&arguments[1]instanceof b)return f.apply(this,arguments);for(var g=[this],d=0;d<arguments.length;d++)g.push(arguments[d]);return f.apply(this,g)})});forEach(keys(a),function(b,g){d[b]=a[b]});return d};b.fromLaTex=e.fromLaTex=function(a){assert("string"===
typeof a,"Model.prototype.fromLaTex");return this?this.create(a):b.create(a)};e.toLaTex=function(b){return s(b)};var a={ADD:"+",SUB:"-",MUL:"times",DIV:"div",FRAC:"frac",EQL:"=",ATAN2:"atan2",SQRT:"sqrt",PM:"pm",SIN:"sin",COS:"cos",TAN:"tan",SEC:"sec",COT:"cot",CSC:"csc",LN:"ln",VAR:"var",NUM:"num",CST:"cst",COMMA:",",POW:"^",ABS:"abs",PAREN:"()",HIGHLIGHT:"hi",INTERVAL:"interval"};forEach(keys(a),function(d,c){b[d]=a[d]});var d={};d[a.ADD]="+";d[a.SUB]="-";d[a.MUL]="\\times";d[a.DIV]="\\div";d[a.FRAC]=
"\\frac";d[a.EQL]="=";d[a.ATAN2]="\\atan2";d[a.POW]="^";d[a.PM]="\\pm";d[a.SIN]="\\sin";d[a.COS]="\\cos";d[a.TAN]="\\tan";d[a.SEC]="\\sec";d[a.COT]="\\cot";d[a.CSC]="\\csc";d[a.LN]="\\ln";d[a.COMMA]=",";var s=function n(b){var g="";if("string"===typeof b)g=b;else if("number"===typeof b)g=b;else if("object"===typeof b){for(var f=[],c=0;c<b.args.length;c++)f[c]=n(b.args[c]);switch(b.op){case a.VAR:case a.CST:case a.NUM:g=b.args[0];break;case a.SUB:g=1===b.args.length?d[b.op]+" "+f[0]:f[0]+" "+d[b.op]+
" "+f[1];break;case a.DIV:case a.PM:case a.EQL:g=f[0]+" "+d[b.op]+" "+f[1];break;case a.POW:var c=b.args[0],e=b.args[1];if(c.args&&2===c.args.length||e.args&&2===e.args.length)if(c.op===a.ADD||c.op===a.SUB||c.op===a.MUL||c.op===a.DIV||c.op===a.SQRT)f[0]=" ("+f[0]+") ";g="{"+f[0]+"^{"+f[1]+"}}";break;case a.SIN:case a.COS:case a.TAN:case a.SEC:case a.COT:case a.CSC:case a.LN:g="{"+d[b.op]+"{"+f[0]+"}}";break;case a.FRAC:g="\\dfrac{"+f[0]+"}{"+f[1]+"}";break;case a.SQRT:switch(f.length){case 1:g="\\sqrt{"+
f[0]+"}";break;case 2:g="\\sqrt["+f[0]+"]{"+f[1]+"}"}break;case a.MUL:var h,g="";forEach(b.args,function(c,e){if(c.args&&2<=c.args.length){if(c.op===a.ADD||c.op===a.SUB)f[e]="("+f[e]+")";0!==e&&"number"===typeof c&&(g+=d[b.op]+" ")}else c.op===a.PAREN||c.op===a.VAR||c.op===a.CST||"number"===typeof h&&"number"!==typeof c||0!==e&&(g+=" "+d[b.op]+" ");g+=f[e];h=c});break;case a.ADD:case a.COMMA:forEach(f,function(a,c){g=0===c?a:g+" "+d[b.op]+" "+a});break;default:assert(!1,"unimplemented eval operator")}}else assert(!1,
"invalid expression type");return g},c=function(a){function c(){m=T;T=t;m===t&&(m=r.start())}function d(b){var a=m;a!==b&&(b=String.fromCharCode(b),a=a?String.fromCharCode(a):"EOS",assert(!1,h(1001,[b,a])));c()}function f(){d(B);var b=u();d(U);return b}function e(){var a;switch(m){case C:c();a=e();break;case v:c();a=e();a={op:b.SUB,args:[a]};break;default:var k;switch(a=m){case 65:case w:k={op:"var",args:[r.lexeme()]};c();break;case 97:k={op:"var",args:[r.lexeme()]};c();break;case V:k={op:"num",args:[r.lexeme()]};
c();break;case Z:d(a);k=u();d(tk2=m===D?D:x);2===k.args.length||a!==E&&tk2!==x||assert(!1,h(1002));k.lbrk=a;k.rbrk=tk2;break;case B:k=f();break;case y:c();a=f();k=f();k={op:b.MUL,args:[a,{op:b.POW,args:[k,{op:b.NUM,args:["-1"]}]}]};break;case F:c();switch(m){case E:d(E);a=u();d(x);k=f();k={op:b.POW,args:[k,a,{op:b.NUM,args:["-1"]}]};break;case B:k=f();k=k.op===b.POW?{op:b.POW,args:[k.args[0],{op:b.MUL,args:[k.args[1],{op:b.POW,args:[{op:b.NUM,args:["2"]},{op:b.NUM,args:["-1"]}]}]}]}:{op:b.POW,args:[k,
{op:b.NUM,args:["2"]},{op:b.NUM,args:["-1"]}]};break;default:assert(!1,h(1001,["{ or (",String.fromCharCode(m)]))}break;case G:case H:case I:case J:case K:case L:case M:c();k={op:l[a],args:[f()]};break;default:assert(!1,"Model.primaryExpr() unexpected expression kind"),k=void 0}a=k}return a}function s(){for(var a=[e()];m===W;)c(),a.push(e());return 1<a.length?{op:b.POW,args:a}:a[0]}function Q(){for(var a,d,f=[s()];(a=m)&&!S(a)&&a!==z&&a!==N&&a!==U&&a!==D&&a!==x;)a===O||a===A?(op=l[a],c()):op=b.MUL,
d=s(),a===A&&(d={op:b.POW,args:[d,{op:b.NUM,args:["-1"]}]}),f.push(d);return 1<f.length?{op:b.MUL,args:f}:f[0]}function R(a){if("number"===typeof a)return-a;if(1===a.args.length){if(a.op===b.SUB)return a.args[0];if(a.op===b.ADD)return a.args[0]=R(a.args[0]),a;if(a.op===b.NUM||a.op===b.VAR)return{op:b.MUL,args:[{op:b.NUM,args:["-1"]},a]}}else if(2===a.args.length)return{op:b.SUB,args:[a]};assert(!1,"Unhandled case in negate() op="+a.op+" n.args.length="+a.args.length);return{op:b.SUB,args:[a]}}function S(a){return a===
C||a===v||a===P}function X(){for(var a=Q(),d;S(d=m);){c();var f=Q();switch(d){case v:f=R(f);default:a={op:b.ADD,args:[a,f]}}}return a}function Y(){for(var a=X(),b;(b=m)===N;){c();var d=X(),a={op:l[b],args:[a,d]}}return a}function u(){for(var a=Y(),b=[a];m===z;)c(),b.push(Y());return 1<b.length?{op:l[z],args:b}:a}var t=0,C=43,W=94,H=261,K=264,L=265,A=47,N=61,y=256,M=263,B=123,E=91,Z=40,O=42,V=48,P=258,U=125,x=93,D=41,J=262,G=259,F=257,v=45,I=260,w=97,z=44,l=[],m=t,T=t;l[y]="frac";l[F]="sqrt";l[C]=
"+";l[v]="-";l[P]="pm";l[W]="^";l[O]="times";l[A]="frac";l[G]="sin";l[H]="cos";l[I]="tan";l[J]="sec";l[K]="cot";l[L]="csc";l[M]="ln";l[N]="=";l[z]=",";var r=function(a){function b(f){var g=String.fromCharCode(f);for(d+=g;97<=f&&122>=f;){f=a.charCodeAt(c++);var g=String.fromCharCode(f),h=d+g;if(!some(e,function(a){return 0===a.indexOf(h)}))break;d+=g}c--;return w}var c=0,d="",f=[];f["\\times"]=O;f["\\div"]=A;f["\\dfrac"]=y;f["\\frac"]=y;f["\\sqrt"]=F;f["\\pm"]=P;f["\\sin"]=G;f["\\cos"]=H;f["\\tan"]=
I;f["\\sec"]=J;f["\\cot"]=K;f["\\csc"]=L;f["\\ln"]=M;var e="g cg kg mg ng m cm km mm nm L mL s cs ks ms ns in ft mi fl cup pt qt gal oz lb".split(" ");return{start:function(){var e;for(d="";c<a.length;)switch(e=a.charCodeAt(c++)){case 32:case 9:case 10:case 13:continue;case 92:d+=String.fromCharCode(e);for(e=a.charCodeAt(c++);97<=e&&122>=e;)d+=String.fromCharCode(e),e=a.charCodeAt(c++);c--;e=f[d];void 0===e&&(e=w);return e;case 40:case 41:case 42:case 43:case 44:case 45:case 47:case 61:case 91:case 93:case 94:case 123:case 125:return d+=
String.fromCharCode(e),e;default:if(65<=e&&90>=e)return d+=String.fromCharCode(e),w;if(97<=e&&122>=e)return b(e);if(46===e||48<=e&&57>=e){for(;48<=e&&57>=e||46===e;)d+=String.fromCharCode(e),e=a.charCodeAt(c++);c--;return V}assert(!1,h(1004,[String.fromCharCode(e),e]));return 0}return 0},lexeme:function(){return d},pos:function(){return c}}}(a);return{expr:function(){m=r.start();var a=u();assert(!m,h(1003,[r.pos(),r.lexeme()]));return a}}};return b}();
